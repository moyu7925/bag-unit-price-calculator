# APK打包指南

## 方案一：使用在线编译服务（推荐，最简单）

### 1. Pythonista Tools（推荐）

访问：https://pythonista.tools/build

步骤：
1. 点击 "Build APK" 按钮
2. 上传你的项目ZIP文件（包括所有Python文件和buildozer.spec）
3. 等待编译完成（通常需要5-15分钟）
4. 下载生成的APK文件

优点：无需配置，完全在线，免费
缺点：需要排队，大项目可能需要较长时间

### 2. Google Colab + Buildozer

使用Google的免费云端Linux环境：

```python
# 在Google Colab中运行
!apt-get install -y python3-pip build-essential git libffi-dev libssl-dev
!pip install buildozer
!buildozer android debug
```

步骤：
1. 访问 https://colab.research.google.com
2. 新建笔记本
3. 将上述代码粘贴到单元格
4. 上传你的项目（需要先压缩为ZIP）
5. 运行代码
6. 在 `/content/bin/` 目录下载APK

优点：完全免费，Linux环境稳定
缺点：需要科学上网，上传项目较麻烦

## 方案二：使用GitHub Actions（推荐）

### 步骤：

1. **创建GitHub仓库**
   - 在GitHub创建新仓库
   - 上传所有项目文件

2. **创建工作流文件**
   在仓库中创建 `.github/workflows/android.yml`：

```yaml
name: Build APK

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-pip build-essential git libffi-dev libssl-dev libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev libportmidi-dev libavformat-dev libswscale-dev
        pip install buildozer
    
    - name: Build APK
      run: |
        buildozer android debug
      env:
        BUILDZER_ANDROID_API: 31
        BUILDZER_ANDROID_NDK: 25b
    
    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: app-debug.apk
        path: bin/*.apk
```

3. **触发构建**
   - 推送代码到main分支
   - 或在GitHub页面手动触发 workflow
   - 在Actions页面下载APK

优点：完全免费，自动构建，版本管理
缺点：需要GitHub账号，首次配置稍复杂

## 方案三：Windows Subsystem for Linux (WSL)

### 安装步骤：

1. **启用WSL**
   ```powershell
   # 在PowerShell（管理员）中运行
   wsl --install
   ```

2. **安装Ubuntu**
   - 打开Microsoft Store
   - 搜索并安装 "Ubuntu 20.04" 或 "Ubuntu 22.04"

3. **配置开发环境**
   ```bash
   # 打开Ubuntu终端
   sudo apt update
   sudo apt install -y python3-pip build-essential git libffi-dev libssl-dev
   pip3 install buildozer
   
   # 安装Android SDK
   sudo apt install -y libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev
   ```

4. **打包项目**
   ```bash
   # 复制项目到WSL
   cd /mnt/c/Users/L/Desktop/单价计算器/mobile
   buildozer android debug
   ```

优点：原生Linux环境，稳定可靠
缺点：需要Windows 10/11，配置稍复杂

## 方案四：使用云服务器

### 推荐服务商：

1. **腾讯云** - 国内访问快
2. **阿里云** - 稳定性好
3. **华为云** - 国内优惠多
4. **AWS** - 免费套餐
5. **Google Cloud** - 免费套餐

### 租用最低配置：

- CPU: 1核
- 内存: 1GB
- 硬盘: 20GB
- 系统: Ubuntu 20.04
- 价格: 约20-50元/月

### 使用步骤：

```bash
# 连接到服务器
ssh root@你的服务器IP

# 安装依赖
apt update
apt install -y python3-pip build-essential git libffi-dev libssl-dev
pip3 install buildozer

# 上传项目
scp -r your_project root@服务器IP:/root/

# 打包
cd your_project
buildozer android debug

# 下载APK
scp root@服务器IP:/root/project/bin/*.apk ./
```

优点：性能强，完全控制
缺点：需要付费，需要Linux基础

## 方案五：使用虚拟机

### 推荐软件：

1. **VirtualBox** - 免费开源
2. **VMware Workstation Player** - 免费版可用
3. **Hyper-V** - Windows自带

### 安装Ubuntu桌面版：

1. 下载Ubuntu ISO镜像：https://ubuntu.com/download
2. 创建虚拟机，挂载ISO
3. 安装Ubuntu系统
4. 按照"方案三"配置环境

优点：完全隔离，不影响主机
缺点：性能较低，配置复杂

## 快速推荐

- **个人用户**：推荐"方案一（Pythonista Tools）"或"方案二（GitHub Actions）"
- **开发者**：推荐"方案三（WSL）"
- **企业用户**：推荐"方案四（云服务器）"

## 常见问题

### Q: APK文件在哪里？
A: 打包完成后，APK文件在 `bin/` 目录下，名称为 `app-debug.apk`

### Q: 如何安装到手机？
A: 
1. 将APK文件传到手机
2. 打开手机设置 → 安全 → 允许安装未知来源应用
3. 点击APK文件安装

### Q: 如何发布到应用商店？
A:
1. 注册开发者账号（华为、小米、应用宝等）
2. 使用 `buildozer android release` 生成签名APK
3. 提交审核

### Q: 打包失败怎么办？
A:
1. 检查 buildozer.spec 配置
2. 查看错误日志
3. 确保网络连接正常
4. 尝试更换打包方案

## 项目打包命令

在你的项目目录（包含buildozer.spec的目录）执行：

```bash
# 调试版本（快速打包）
buildozer android debug

# 发布版本（需要签名）
buildozer android release
```

## 文件结构要求

确保项目包含以下文件：
```
mobile/
├── main.py
├── calculator.kv
├── calculator_logic.py
├── template_manager.py
├── buildozer.spec
└── templates/          (如果存在)
    └── *.json
```
